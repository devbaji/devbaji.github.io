"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("vue"),t=Object.freeze({__proto__:null});var o={library:"https://accounts.google.com/gsi/client",defaultButtonConfig:{theme:"outline",size:"large"}};const n=e.reactive({clientId:null,popupType:"CODE",prompt:!1,autoLogin:!1,idConfiguration:null,buttonConfig:o.defaultButtonConfig,callback:()=>{}}),i=e.reactive({apiLoaded:!1,apiLoadIntitited:!1}),a=new Promise((e=>{if(!i.apiLoadIntitited){const t=document.createElement("script");i.apiLoadIntitited=!0,t.addEventListener("load",(()=>{i.apiLoaded=!0,e(window.google)})),t.src=o.library,t.async=!0,t.defer=!0,document.head.appendChild(t)}})),l=t=>{i.apiLoadIntitited?i.apiLoaded?t(window.google):e.watch((()=>i.apiLoaded),(e=>{e&&t(window.google)})):a.then((e=>{t(e)}))},d=(e,t,o,n)=>{if(!e.client_id)throw new Error("A valid Google API client ID must be provided");l((()=>{((e,t,o,n=!1,i)=>{window.google.accounts.id.initialize(e);const a=document.getElementById(t);a&&!i&&window.google.accounts.id.renderButton(a,o),n&&window.google.accounts.id.prompt()})(e,t,o.buttonConfig,o.prompt,n)}))},c=e=>new Promise(((t,o)=>{l((i=>{if(!e&&!n.clientId)throw new Error("clientId is required since the plugin is not initialized with a Client Id");i.accounts.oauth2.initCodeClient({client_id:e||n.clientId||"",scope:"email profile",ux_mode:"popup",callback:e=>{e.code?t(e):o(e)}}).requestCode()}))})),r=e=>new Promise(((t,o)=>{l((i=>{if(!e&&!n.clientId)throw new Error("clientId is required since the plugin is not initialized with a Client Id");i.accounts.oauth2.initTokenClient({client_id:e||n.clientId||"",scope:"email profile",callback:e=>{e.access_token?t(e):o(e)}}).requestAccessToken()}))}));var p=e.defineComponent({props:{clientId:{type:String,required:!1},prompt:{type:Boolean,required:!1,default:!1},autoLogin:{type:Boolean,required:!1,default:!1},popupType:{type:String,required:!1,default:"CODE"},idConfiguration:{type:Object,required:!1},buttonConfig:{type:Object,required:!1},callback:{type:Function,required:!1}},setup(t){const o=t,a=!!e.useSlots().default,l=((e,t)=>{const o={...e};for(const e in t)void 0!==t[e]&&null!==t[e]&&(o[e]=t[e]);return o})(n,o),p={client_id:l.clientId||null,auto_select:l.autoLogin||!1,callback:l.callback,...l.idConfiguration},s=`g-btn-${"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}`;return e.onMounted((()=>{d(p,s,l,a)})),(t,o)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["g-btn-wrapper",[!e.unref(i).apiLoaded&&"api-loading"]]),onClick:o[0]||(o[0]=t=>e.unref(a)&&void("TOKEN"===e.unref(l).popupType?r(l.clientId).then((e=>{l.callback&&l.callback(e)})):c(l.clientId).then((e=>{l.callback&&l.callback(e)}))))},[e.unref(a)?e.createCommentVNode("v-if",!0):(e.openBlock(),e.createElementBlock("span",{key:0,id:s,class:"g-btn"})),e.renderSlot(t.$slots,"default")],2))}});!function(e,t){void 0===t&&(t={});var o=t.insertAt;if(e&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===o&&n.firstChild?n.insertBefore(i,n.firstChild):n.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}("\n.g-btn-wrapper[data-v-5e610566] {\n  display: inline-block;\n}\n.g-btn-wrapper.api-loading[data-v-5e610566] {\n  opacity: 0.5;\n  pointer-events: none;\n}\n"),p.__scopeId="data-v-5e610566",p.__file="src/plugin/GoogleLogin.vue";var s={install:(e,t)=>{t&&(e=>{e.clientId&&(n.clientId=e.clientId),e.popupType&&(n.popupType=e.popupType),null!=e.prompt&&(n.prompt=e.prompt),null!=e.autoLogin&&(n.autoLogin=e.autoLogin),e.idConfiguration&&(n.idConfiguration=e.idConfiguration),e.buttonConfig&&(n.buttonConfig=e.buttonConfig),e.callback&&(n.callback=e.callback)})(t),a.then((()=>{t&&(e=>{if(e.clientId){const t={client_id:e.clientId,auto_select:!0===e.autoLogin,callback:e.callback,...e.idConfiguration};window.google.accounts.id.initialize(t),e.prompt&&window.google.accounts.id.prompt()}})(t)})),e.component("GoogleLogin",p)}};exports.CallbackTypes=t,exports.GoogleLogin=p,exports.decodeCredential=e=>{try{const t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),o=decodeURIComponent(atob(t).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""));return JSON.parse(o)}catch(e){throw"JWT provided is invalid"}},exports.default=s,exports.googleAuthCodeLogin=c,exports.googleLogout=()=>{l((e=>{e.accounts.id.disableAutoSelect()}))},exports.googleOneTap=e=>{if(!e&&(e={}),!e.clientId&&!n.clientId)throw new Error("clientId is required");const t={};return e.clientId&&(t.client_id=e.clientId),!e.clientId&&n.clientId&&(t.client_id=n.clientId),e.context&&(t.context=e.context),null!=e.autoLogin&&(t.auto_select=e.autoLogin),null!=e.cancelOnTapOutside&&(t.cancel_on_tap_outside=e.cancelOnTapOutside),new Promise(((o,n)=>{t.callback=t=>{e&&e.callback&&e.callback(t),t.credential?o(t):n(t)},l((o=>{o.accounts.id.initialize(t),o.accounts.id.prompt((t=>{e&&e.onNotification&&e.onNotification(t),t.isNotDisplayed()&&("suppressed_by_user"===t.getNotDisplayedReason()?n("Prompt was suppressed by user'. Refer https://developers.google.com/identity/gsi/web/guides/features#exponential_cooldown for more info"):n(`Prompt was not displayed, reason for not displaying:${t.getNotDisplayedReason()}`)),t.isSkippedMoment()&&n(`Prompt was skipped, reason for skipping: ${t.getSkippedReason()}`)}))}))}))},exports.googleSdkLoaded=l,exports.googleTokenLogin=r,exports.useGoogleSdkLoaded=()=>{const t=e.ref(!1);return e.watch((()=>i.apiLoaded),(e=>{t.value=e})),t};
